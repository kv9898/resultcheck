name: "Copilot Setup Steps"

# Automatically run the setup steps for Copilot to work properly.
on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  # The job MUST be called `copilot-setup-steps` or it will not be picked up by Copilot.
  copilot-setup-steps:
    runs-on: ubuntu-22.04 # <= pin to jammy for better binaries

    steps:
      - name: Checkout code
        uses: actions/checkout@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            cmake \
            libcurl4-openssl-dev \
            libfontconfig1-dev \
            libfreetype6-dev \
            libpng-dev \
            libx11-dev \
            pkg-config \
            libharfbuzz-dev \
            libfribidi-dev \
            libxml2-dev
          
      # ------------------- R -----------------
      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          use-public-rspm: true

      # ---------- Quarto + TinyTeX ----------
      - name: Setup Quarto (with TinyTeX for PDF)
        uses: quarto-dev/quarto-actions/setup@v2
        with:
          tinytex: true

      # ---------- R package dependencies ----------
      - name: Install R package dependencies
        run: |
          install.packages(c("remotes", "devtools"))
          remotes::install_deps(dependencies = TRUE)
        shell: Rscript {0}

      # ---------- R packages via renv ----------
      # - name: Setup renv
      #   uses: r-lib/actions/setup-renv@v2
      #   env:
      #     RENV_CONFIG_REPOS_OVERRIDE: https://packagemanager.posit.co/cran/latest
      #     RENV_CONFIG_INSTALL_MODE: "binary"
      #   with:
      #     # Defaults to renv.lock at repo root; adjust if yours lives elsewhere
      #     cache-version: 1
